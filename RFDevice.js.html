<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Source: RFDevice.js - Homey RFDriver</title>

  <meta property="og:image" content="https://etc.athom.com/logo/white/256.png" />
  <link rel="icon" href="https://etc.athom.com/logo/transparent/128.png" />
  <link rel="icon" type="image/png" href="https://etc.athom.com/logo/transparent/128.png" />
  <link rel="preload" as="image" href="images/logo.png">
  <link rel="preload" href="styles/homey.min.css" as="style">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="preconnect" href="styles/atom-one-light.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&family=Roboto:wght@100;300;400;500;700&display=swap"
        rel="stylesheet">
  <link type="text/css" rel="stylesheet" href="styles/homey.min.css">
</head>

<body>
<div class="container">
  <nav class="navigation container__navigation component">
    <header class="navigation__header">
                <div class="navigation__logo"><a href="index.html"><img class="display-block" src="images/logo.png" width="40" height="40" alt="Homey"></a></div>
                <h2 class="navigation__title"><a href="index.html">Homey RFDriver</a></h2>
                <button data-navigation-toggle class="navigation__button" title="menu"></button>
             </header><div class="navigation__content" data-navigation-target><div class="navigation__search search">
            <input title="filter" placeholder="Filter..." data-navigation-search class="search__input" type="search">
            <button data-navigation-search-reset class="search__reset --mask" type="button" title="Reset"></button>
           </div><div data-navigation-scroll class="navigation__scroll scroll trim"><div class="navigation__menu trim"><nav class="nav-group"><h3 class="nav-group__title">Classes</h3><ul class="nav-group__list"><li data-lvl="0" data-search-key="rfdevice" class="nav-group__item"><a href="RFDevice.html"> RFDevice</a></li><li data-lvl="0" data-search-key="rfdriver" class="nav-group__item"><a href="RFDriver.html"> RFDriver</a></li><li data-lvl="0" data-search-key="rferror" class="nav-group__item"><a href="RFError.html"> RFError</a></li><li data-lvl="0" data-search-key="rfsignal" class="nav-group__item"><a href="RFSignal.html"> RFSignal</a></li><li data-lvl="0" data-search-key="rfutil" class="nav-group__item"><a href="RFUtil.html"> RFUtil</a></li></ul></nav></div></div></div>
  </nav>

  <main id="main" class="main container__main">
    
  
  
  <div class="main__center">
    <div class="main__content align-baseline">
      <h1 class="text-preset-heading-1">
        Source: RFDevice.js
      </h1>
      
    <section>
        <article>
            <pre class="source linenums"><code>'use strict';

const Homey = require('homey');
const RFUtil = require('./RFUtil');

/**
 * @extends Homey.Device
 * @hideconstructor
 */
class RFDevice extends Homey.Device {

  // Overload Me
  /** @type {boolean} */
  static RX_ENABLED = false;

  /** @type {object} */
  static CAPABILITIES = {};

  constructor(...props) {
    super(...props);

    this.onCapability = this.onCapability.bind(this);
    this.onRX = this.onRX.bind(this);
  }

  /*
   * Lifecycle
   */
  /**
   * Do not use this method, but use {@link RFDevice#onRFInit} instead.
   * @returns {Promise&lt;void>}
   */
  async onInit() {
    // Initialize RF
    Object.keys(this.constructor.CAPABILITIES).forEach(capabilityId => {
      if (!this.hasCapability(capabilityId)) return;
      this.registerCapabilityListener(capabilityId, (...args) => {
        const isVolumeChangeCapability = capabilityId === 'volume_down' || capabilityId === 'volume_up';
        if (this.hasCapability('volume_mute') &amp;&amp; isVolumeChangeCapability) {
          this.setCapabilityValue('volume_mute', false);
        }
        return this.onCapability(capabilityId, ...args);
      });
    });

    this.driver = this.driver || this.getDriver();

    // Enable RX if this Driver uses RX
    if (this.constructor.RX_ENABLED) {
      await this.driver.enableRX(this.onRX);
    }

    await this.onRFInit();
  }

  /**
   * @returns {Promise&lt;void>}
   */
  async onRFInit() {
    // Overload Me
  }

  /**
   * @returns {Promise&lt;void>}
   */
  async onDeleted() {
    // Disable RX if this Driver uses RX
    if (this.constructor.RX_ENABLED) {
      await this.driver.disableRX(this.onRX);
    }

    await this.onRFDeleted();
  }

  /**
   * @returns {Promise&lt;void>}
   */
  async onRFDeleted() {
    // Overload Me
  }

  /**
   * @description Device-specific methods
   * @param {string} capabilityId
   * @param {*} value
   * @param {object} opts
   * @returns {Promise&lt;void>}
   */
  async onCapability(capabilityId, value, opts = {}) {
    const data = this.getData();
    const listener = this.constructor.CAPABILITIES[capabilityId];

    // If this is an Object of Signal Commands
    // Example:
    // static CAPABILITIES = { onoff: { 'true': 'POWER_ON', 'false': 'POWER_OFF' }}
    if (typeof listener === 'object') {
      const command = listener[String(value)];
      if (!command) {
        throw new Error(`Missing Command For Capability ${capabilityId} Value: ${value}`);
      }

      const signal = await this.driver.getRFSignal();
      await signal.cmd(command);
      return;
    }

    // If this is an Command
    // Example:
    // static CAPABILITIES = { volume_up: 'VOLUME_UP' }
    if (typeof listener === 'string') {
      const signal = await this.driver.getRFSignal();
      await signal.cmd(listener);
      return;
    }

    // If this is a function
    // Example:
    // static CAPABILITIES = { async dim(value) { ... } }
    if (typeof listener === 'function') {
      const command = await listener.call(this, { value, opts, data });
      await this.driver.tx(command);
      return;
    }

    throw new Error(`Invalid Capability Listener: ${capabilityId}`);
  }

  /**
   * @param command
   * @param {object} args
   * @param {boolean} args.isFirst
   * @param {object} args.flags
   * @returns {Promise&lt;void>}
   */
  async onRX(command, { isFirst, ...flags } = {}) {
    const match = await this.onCommandMatch(command);

    if (match) {
      await Promise.all([
        this.onCommand(command, { isFirst, ...flags }),
        isFirst &amp;&amp; this.onCommandFirst(command, { ...flags }),
      ]);
    }
  }

  /**
   * @param command
   * @returns {Promise&lt;*>}
   */
  async onCommandMatch(command) {
    const signal = await this.driver.getRFSignal();
    const currentDeviceData = await this.getData();
    const commandDeviceData = signal.constructor.commandToDeviceData(command);
    return RFUtil.deepEqual(currentDeviceData, commandDeviceData);
  }

  /**
   * @param command
   * @param {object} flags
   * @returns {Promise&lt;void>}
   */
  async onCommandFirst(command, { ...flags } = {}) {
    // Overload Me
  }

  /**
   * @param command
   * @param {object} args
   * @param {boolean} args.isFirst
   * @returns {Promise&lt;void>}
   */
  async onCommand(command, { isFirst }) {
    // Overload Me
  }

}

module.exports = RFDevice;
</code></pre>
        </article>
    </section>
    </div>
  </div>
  



  </main>
</div>

<script src="scripts/ready.js"></script>
<script src="scripts/navigation.js"></script>
<script src="scripts/toc.js"></script>
<script src="scripts/table.js"></script>

<link type="text/css" rel="stylesheet" href="styles/atom-one-light.css">
<script src="scripts/highlight.min.js"></script>
<!--<script src="scripts/linenumber.js"></script>-->


<script async defer src="https://sa.athom.com/latest.js"></script>

</body>
</html>
